---
title: Docker
---

import { Aside } from '@astrojs/starlight/components';

In a lot cases, we build our application using Docker so we can host it somewhere else.

We can achieve that in various ways but maybe the most optimal one would be by using a technique called [Multi-stage builds](https://docs.docker.com/build/building/multi-stage/), which consist on having a couple of layers preparing the application and at the end, build an image only the production code of our app, here's an example:

```dockerfile
# Phase 1: Build the application
FROM node:22-alpine AS builder
WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci

COPY . .

RUN npm run build

# Phase 2: Prepare the production image
FROM node:22-alpine AS production
WORKDIR /app

ENV NODE_ENV=production

COPY package.json package-lock.json ./
RUN npm ci --include=prod

## Output from build step on builder stage
COPY --from=builder /app/dist ./dist
## Production server
COPY server.js ./

EXPOSE 5173

CMD ["node", "server.js"]
```

The advantage of this strategy is that you have a much leaner image that contains only `production` dependencies and the bundled files.

If you're already using this strategy and add `layerfig`, probably you'll face an error like this:

```
Error: File "/app/config/base.json" does not exist
    at ConfigBuilder.addSource (file:///app/node_modules/@layerfig/config/dist/index.js:78:46)
    at file:///app/dist/server/entry-server.js:6:48
    at ModuleJob.run (node:internal/modules/esm/module_job:274:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:644:26)
    at async file:///app/server.js:51:17
```

That's because now you also need to include the config files in the final production stage:

```diff lang="dockerfile"
# Phase 1: Build the application
FROM node:22-alpine AS builder
WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci

COPY . .

RUN npm run build

# Phase 2: Prepare the production image
FROM node:22-alpine AS production
WORKDIR /app

ENV NODE_ENV=production

COPY package.json package-lock.json ./
RUN npm ci --include=prod

## Output from build step on builder stage
COPY --from=builder /app/dist ./dist
## Production server
COPY server.js .
+## Include config files
+COPY ./config ./config

EXPOSE 5173

CMD ["node", "server.js"]
```

And now, your application will contain the configuration files and load it properly.

<Aside>
    See an entire example at [Docker Example](/examples/docker)
</Aside>
